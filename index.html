<!--
Ayman Alsulwy
Ø§ØªÙ…Ù†Ù‰ Ù„Ø§ ØªÙ†Ø³Ù‰ ØªØ´ØªØ±Ùƒ ÙÙŠ Ø§Ù„Ù‚Ù†Ø§Ø© ÙˆØªÙØ¹Ù„ Ø²Ø± Ø§Ù„Ø¬Ø±Ø³
-->

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>OSINT Analyzer Ultimate (Rako)</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://unpkg.com/vis-network/styles/vis-network.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body { font-family:  Rubik , sans-serif; background:#121212; color:#fff; }
.container { max-width: 1400px; }
#resultMap { border:2px solid #333; height:700px; margin-top:20px; background:#1e1e1e; border-radius:12px; }
#results { background:#222; padding:15px; border-radius:10px; max-height:300px; overflow:auto; color:#eee; font-size:14px; }
.tooltip-custom { position:absolute; background:rgba(0,0,0,0.9); color:#fff; padding:12px; border-radius:8px; max-width:350px; font-size:14px; display:none; z-index:1000; box-shadow:0 0 15px rgba(255,255,255,0.2);}
.result-card { background:#1e1e1e; padding:10px; margin-bottom:10px; border-radius:10px; display:flex; align-items:center; gap:10px; border:1px solid #444; }
.result-card img { width:50px; height:50px; border-radius:50%; object-fit:cover; }
.result-card .info { flex:1; }
.result-card .info .title { font-weight:bold; color:#ffc107; }
.result-card .info .link { font-size:12px; color:#6cf; word-break:break-all; }
.result-card .info .type { font-size:12px; color:#fff; background:#444; padding:2px 6px; border-radius:4px; margin-top:4px; display:inline-block; }
.result-card button { background:#ff9800; border:none; color:#000; padding:3px 6px; border-radius:6px; cursor:pointer; }
.result-card button:hover { background:#ffc107; }
</style>
</head>
<body>
<div class="container mt-4">
    <h2 class="text-center mb-3">ğŸ” OSINT Analyzer Ultimate</h2>

    <form id="searchForm" class="p-3 bg-dark rounded mt-3">
        <div class="input-group mb-2">
            <input type="text" id="queryInput" class="form-control" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ Ø§Ùˆ Ø§Ù„Ø´Ø±ÙƒØ© ..." required>
            <button class="btn btn-warning"><i class="fa-solid fa-magnifying-glass"></i> Ø¨Ø­Ø«</button>
        </div>
        <div class="input-group">
            <label class="input-group-text" for="depthSelect">Ø¹Ù…Ù‚ Ø§Ù„Ø¨Ø­Ø«</label>
            <select id="depthSelect" class="form-select">
                <option value="1">1 ØµÙØ­Ø©</option>
                <option value="2" selected>2 ØµÙØ­Ø§Øª</option>
                <option value="3">3 ØµÙØ­Ø§Øª</option>
                <option value="5">5 ØµÙØ­Ø§Øª</option>
            </select>
        </div>
    </form>

    <div id="resultMap"></div>

    <div class="mt-4 p-3 bg-dark rounded">
        <h4><i class="fa-solid fa-list"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø®Ø§Ù…</h4>
        <div id="results"></div>
    </div>
</div>

<div id="tooltip" class="tooltip-custom"></div>

<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script>
const tooltip = document.getElementById("tooltip");

document.getElementById("searchForm").onsubmit = async function(e){
    e.preventDefault();
    let form = new FormData();
    form.append("query", document.getElementById("queryInput").value);
    form.append("depth", document.getElementById("depthSelect").value);

    const res = await fetch("/search", { method:"POST", body:form });
    const data = await res.json();

    renderResults(data);
    renderGraph(data, document.getElementById("queryInput").value);
}

function renderResults(data){
    const container = document.getElementById("results");
    container.innerHTML = "";

    const types = {};
    data.forEach(result=>{
        if(!types[result.type]) types[result.type]=[];
        types[result.type].push(result);
    });

    for(const type in types){
        types[type].forEach(result=>{
            const card = document.createElement("div");
            card.className = "result-card";

            const img = document.createElement("img");
            img.src = result.image || "https://cdn-icons-png.flaticon.com/512/565/565547.png";

            const info = document.createElement("div");
            info.className = "info";
            info.innerHTML = `
                <div class="title">${result.title}</div>
                <div class="link">${result.link}</div>
                <div class="type">${result.type}</div>
            `;

            const btn = document.createElement("button");
            btn.textContent = "ØªÙØ§ØµÙŠÙ„";
            btn.onclick = ()=> alert(`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${result.title}\nØ§Ù„Ø±Ø§Ø¨Ø·: ${result.link}\nØ§Ù„Ù†ÙˆØ¹: ${result.type}`);

            card.appendChild(img);
            card.appendChild(info);
            card.appendChild(btn);
            container.appendChild(card);
        });
    }
}

function renderGraph(data, queryName){
    // Ø¥Ø°Ø§ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª â€” Ø£Ø¸Ù‡Ø± Ø±Ø³Ø§Ù„Ø© ÙˆÙ‚Ù
    if(!data || data.length === 0){
        document.getElementById("resultMap").innerHTML =
        "<h3 class= text-center mt-5 text-danger >Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„Ø±Ø³Ù… Ø§Ù„Ø®Ø±ÙŠØ·Ø©</h3>";
        return;
    }

    // Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„ÙØ§Ø±Øº
    data = data.map(r=>{
        if(!r.type || r.type === "" || r.type === null) r.type = "Websites";
        return r;
    });

    let nodes = [], edges = [], nid=2;

    nodes.push({
        id:1,
        label: queryName,
        shape:"box",
        color:"#ffc107",
        font:{color:"#000", size:18},
        title:"Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«"
    });

    const typeGroups = {};
    data.forEach(r=>{
        if(!typeGroups[r.type]) typeGroups[r.type] = [];
        typeGroups[r.type].push(r);
    });

    const icons = {
        "Twitter":["#1DA1F2","https://cdn-icons-png.flaticon.com/512/733/733579.png"],
        "Facebook":["#4267B2","https://cdn-icons-png.flaticon.com/512/733/733547.png"],
        "Instagram":["#E1306C","https://cdn-icons-png.flaticon.com/512/2111/2111463.png"],
        "YouTube":["#FF0000","https://cdn-icons-png.flaticon.com/512/1384/1384060.png"],
        "Telegram":["#0088cc","https://cdn-icons-png.flaticon.com/512/2111/2111646.png"],
        "LinkedIn":["#0077B5","https://cdn-icons-png.flaticon.com/512/174/174857.png"],
        "WhatsApp":["#25D366","https://cdn-icons-png.flaticon.com/512/733/733585.png"],
        "GitHub":["#333","https://cdn-icons-png.flaticon.com/512/733/733553.png"],
        "Reddit":["#FF4500","https://cdn-icons-png.flaticon.com/512/2111/2111581.png"],
        "Medium":["#00ab6c","https://cdn-icons-png.flaticon.com/512/2111/2111504.png"],
        "StackOverflow":["#f48024","https://cdn-icons-png.flaticon.com/512/2111/2111628.png"],
        "Pinterest":["#bd081c","https://cdn-icons-png.flaticon.com/512/2111/2111432.png"],
        "TikTok":["#69C9D0","https://cdn-icons-png.flaticon.com/512/3046/3046121.png"],
        "Websites":["#6cf","https://cdn-icons-png.flaticon.com/512/565/565547.png"],
        "Emails":["#FF9800","https://cdn-icons-png.flaticon.com/512/561/561127.png"],
        "Phone Numbers":["#4CAF50","https://cdn-icons-png.flaticon.com/512/15/15874.png"]
    };

    for(const type in typeGroups){
        let typeId = nid++;
        let [color, icon] = icons[type] || ["#6cf","https://cdn-icons-png.flaticon.com/512/565/565547.png"];

        nodes.push({
            id:typeId,
            label:type,
            shape:"image",
            image:icon,
            font:{color:"#fff"},
            title:`ØªØµÙ†ÙŠÙ: ${type}`
        });
        edges.push({from:1, to:typeId, arrows:{to:{enabled:true, scaleFactor:2}}, smooth:true, length:350});

        typeGroups[type].forEach(result=>{
            let id = nid++;
            nodes.push({
                id,
                label: result.title,
                shape:"image",
                image: result.image || icon,
                font:{color:"#fff"},
                title:`${result.title}\n${result.link}\nÙ†ÙˆØ¹: ${result.type}`
            });
            edges.push({from:typeId, to:id, arrows:{to:{enabled:true}}, dashes:true, smooth:{type: cubicBezier }, length:200});
        });
    }

    const container = document.getElementById("resultMap");
    const network = new vis.Network(container, {nodes:new vis.DataSet(nodes), edges:new vis.DataSet(edges)}, {
        physics:{
            enabled:true,
            barnesHut:{gravitationalConstant:-8000, centralGravity:0.3, springLength:300, springConstant:0.04, damping:0.09},
        },
        interaction:{hover:true, zoomView:true, dragView:true}
    });

    network.on("hoverNode", function(params){
        const node = network.body.data.nodes.get(params.node);
        tooltip.innerHTML = node.title || node.label;
        tooltip.style.display = "block";
        tooltip.style.left = (params.event.pageX + 10) + "px";
        tooltip.style.top  = (params.event.pageY + 10) + "px";
    });
    network.on("blurNode",()=> tooltip.style.display="none");
}
</script>
</body>
</html>
